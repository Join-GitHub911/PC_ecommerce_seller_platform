# API 响应格式规范

## 简介

本文档定义了前后端交互的标准 API 响应格式，所有接口都必须遵循此规范，以确保前后端协作的一致性和可靠性。

## 标准响应格式

所有 API 响应必须采用以下标准格式：

```json
{
  "code": 200,                   // 状态码：200成功，非200为各种错误码
  "message": "操作成功",          // 状态消息：简短的操作结果描述
  "data": {                      // 返回的数据对象（可选）
    // 具体业务数据...
  },
  "pagination": {                // 分页信息（可选，仅在分页接口中使用）
    "total": 100,                // 总记录数
    "current": 1,                // 当前页码
    "pageSize": 10               // 每页大小
  }
}
```

### 关键字段说明

- **code**：数字类型，表示操作结果的状态码
  - `200`：表示操作成功
  - 非 `200` 值：表示各种错误情况，详见错误码部分

- **message**：字符串类型，用人类可读的方式描述操作结果
  - 成功时通常为"操作成功"，"保存成功"等
  - 失败时应提供有意义的错误信息，帮助调试和用户理解

- **data**：对象类型（可选），包含API返回的实际业务数据
  - 当没有需要返回的数据时，可以省略此字段，或返回`null`
  - 数据结构应根据API接口的不同而变化，但要确保结构一致性

- **pagination**：对象类型（可选），仅在分页接口中返回分页信息
  - 包含分页所需的 `total`（总条数）、`current`（当前页）和 `pageSize`（每页条数）

## 响应类型

### 成功响应

当操作成功时，应返回：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 业务数据
  }
}
```

### 错误响应

当操作失败时，应返回：

```json
{
  "code": 400,           // 错误状态码，根据具体错误而不同
  "message": "参数错误",  // 具体的错误信息
}
```

## 标准错误码定义

| 错误码 | 说明 | 使用场景 |
| ----- | ---- | ------- |
| 200 | 成功 | 请求处理成功 |
| 400 | 请求错误 | 请求参数有误 |
| 401 | 未授权 | 用户未登录或token失效 |
| 403 | 禁止访问 | 用户无权限访问该资源 |
| 404 | 资源不存在 | 请求的数据或API不存在 |
| 422 | 数据验证错误 | 提交数据未通过验证规则 |
| 500 | 服务器错误 | 服务器内部错误 |

## 特定接口的响应格式

### 认证相关接口

#### 登录响应

登录成功时的响应格式：

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "1001",
      "username": "johndoe",
      "email": "john@example.com",
      "phone": "13800138000",
      "role": "user",
      "avatar": "https://example.com/avatar.jpg",
      "lastLoginTime": "2023-04-01T12:00:00Z"
    }
  }
}
```

登录失败时的响应格式：

```json
{
  "code": 401,
  "message": "用户名或密码错误"
}
```

#### 注册响应

注册成功时的响应格式：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "1002",
      "username": "newuser",
      "email": "newuser@example.com",
      "phone": "13900139000",
      "role": "user",
      "avatar": "https://example.com/default-avatar.jpg",
      "lastLoginTime": "2023-04-02T15:30:00Z"
    }
  }
}
```

注册失败时的响应格式（以用户名已存在为例）：

```json
{
  "code": 422,
  "message": "用户名已存在，请更换其他用户名"
}
```

### 商品相关接口

#### 商品列表响应

商品列表响应格式（含分页）：

```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    {
      "id": "p001",
      "name": "商品名称",
      "price": 199.99,
      "originalPrice": 299.99,
      "cover": "https://example.com/product.jpg",
      "sales": 1000
    },
    // 更多商品...
  ],
  "pagination": {
    "total": 100,
    "current": 1,
    "pageSize": 10
  }
}
```

## 前后端实现

### 后端实现

后端应提供统一的响应处理机制，确保所有API返回符合本规范的响应格式。推荐在全局异常处理器和响应拦截器中统一处理。

### 前端实现

前端应在请求拦截器中对响应格式进行统一验证，确保符合标准格式。对于不同状态码，应有标准的处理流程。

## 总结

本文档定义的响应格式规范旨在统一前后端通信协议，减少因响应格式不一致导致的问题，提高系统的可维护性和稳定性。所有开发人员必须严格遵循此规范。 